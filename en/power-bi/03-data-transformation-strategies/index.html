<!DOCTYPE html>
<html lang="en-UK">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.4.0">

  <title>Data transformation strategies | MarcusRB</title>
    


  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Marco Russo">

  
  <meta name="robots" content="index,follow">

  
  
  
    
  
  <meta name="description" content="El sistema de archivos controla como se almacenan los archivos en el ordenador. Sus dos tareas principales son guardar y leer archivos previamente guardados.">

  
  <link rel="alternate" hreflang="en-UK" href="https://www.marcusrb.com/en/power-bi/03-data-transformation-strategies/">

  


  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:200,500|Merriweather:200,300|Roboto+Mono:300,400&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.561c2ba69cc8c6babcfc0393b003a821.css">

  

  
  
  

  
  
    
    
    <script>
      var dataLayer = window.dataLayer = window.dataLayer || [];
      dataLayer.push({
        page:'Data transformation strategies',
        categories:''
      });
    </script>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MPFRNJ');</script>


    
  

  

  <link rel="manifest" href="/en/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://www.marcusrb.com/en/power-bi/03-data-transformation-strategies/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="twitter:site" content="@rb_marcus">
  <meta property="twitter:creator" content="@rb_marcus">
  
  <meta property="og:site_name" content="MarcusRB | data specialist &amp; professor • AI • Big Data">
  <meta property="og:url" content="https://www.marcusrb.com/en/power-bi/03-data-transformation-strategies/">
  <meta property="og:title" content="Data transformation strategies | MarcusRB | data specialist &amp; professor • AI • Big Data">
  <meta property="og:description" content="El sistema de archivos controla como se almacenan los archivos en el ordenador. Sus dos tareas principales son guardar y leer archivos previamente guardados."><meta property="og:image" content="https://www.marcusrb.com/img/icon-192.png">
  <meta property="twitter:image" content="https://www.marcusrb.com/img/icon-192.png"><meta property="og:locale" content="en-UK">
  
    
      <meta property="article:published_time" content="2021-01-04T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2021-01-05T13:36:36&#43;01:00">
  

  


  





</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  
  



    <noscript>
      <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MPFRNJ" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>

  


  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    
      <a class="navbar-brand" href="/en/">MarcusRB</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/en/#home"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/en/services"><span>Services</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/en/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/en/courses"><span>Courses</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/en/resources"><span>Resources</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/en/#contact"><span>Contact</span></a>
        </li>

        
        

      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      





<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/en/power-bi-resources/">Power BI index</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/en/en/power-bi/01-intro-power-bi/">Intro a Power BI</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/en/power-bi/02-import-data/">Import Data</a>

  </div>
  
  <div class="docs-toc-item active">
    <a class="docs-toc-link" href="/en/power-bi/03-data-transformation-strategies/">Data transformation strategies</a>

  </div>
  
  
</nav>

    </div>

    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>

      <nav id="TableOfContents">
<ul>
<li><a href="#data-transformation-strategies">Data Transformation Strategies</a></li>
<li><a href="#the-power-query-editor">The Power Query Editor</a></li>
<li><a href="#transform-basics">Transform basics</a>
<ul>
<li><a href="#use-first-row-as-headers">Use First Row as Headers</a></li>
<li><a href="#remove-columns">Remove Columns</a></li>
<li><a href="#change-type">Change Type</a></li>
<li><a href="#column-from-examples">Column From Examples</a></li>
</ul></li>
<li><a href="#advanced-data-transformation-options">Advanced data transformation options</a>
<ul>
<li><a href="#conditional-columns">Conditional Columns</a></li>
<li><a href="#fill-down">Fill Down</a></li>
<li><a href="#unpivot">Unpivot</a></li>
<li><a href="#merge-query">Merge Query</a></li>
<li><a href="#append-query">Append Query</a></li>
</ul></li>
<li><a href="#leveraging-r">Leveraging R</a>
<ul>
<li><a href="#installation-and-configuration">Installation and configuration</a></li>
<li><a href="#the-r-script-transform">The R script transform</a></li>
</ul></li>
<li><a href="#ai-insights">AI Insights</a>
<ul>
<li><a href="#sentiment-analysis-with-text-analytics">Sentiment Analysis with Text Analytics</a></li>
</ul></li>
<li><a href="#the-m-formula-language">The M formula language</a>
<ul>
<li><a href="#shared">#shared</a></li>
</ul></li>
<li><a href="#summary">Summary</a></li>
</ul>
</nav>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article" itemscope itemtype="http://schema.org/Article">

        <div class="docs-article-container">
          <h1 itemprop="name">Data transformation strategies</h1>

          <div class="article-style" itemprop="articleBody">
            

<h1 id="data-transformation-strategies">Data Transformation Strategies</h1>

<p>Within any BI project, it is essential that the  data you are working with has been properly scrubbed to ensure accurate  results on your reports and dashboards. Applying data cleansing business rules, also known as transforms, is the primary method for correcting  inaccurate or malformed data, but the process can often be the most  time-consuming part of any corporate BI solution. However, the data  transformation capabilities built into Power BI are both very powerful  and user-friendly. Using the Power Query Editor, tasks that would  typically be difficult or time-consuming in an enterprise BI tool are as simple as right-clicking on a column and selecting the appropriate  transform for the field. While interacting with the user interface, the  Power Query Editor automatically writes queries using a language called M behind the scenes.</p>

<p>Through the course of this chapter, you will  explore some of the most common features of the Power Query Editor that  make it so highly regarded by its users. Since one sample dataset cannot provide all the problems you will run into, you will be provided with  several small, disparate examples to show you what is possible. This  chapter will detail the following topics:</p>

<ul>
<li>The Power Query Editor</li>
<li>Transform basics</li>
<li>Advanced data transformation options</li>
<li>Leveraging R</li>
<li>AI Insights</li>
<li>The M formula language</li>
</ul>

<p>To get started, let&rsquo;s get familiar with the interface known as the Power Query Editor.</p>

<h1 id="the-power-query-editor">The Power Query Editor</h1>

<p>The <strong>Power Query Editor</strong> is the primary tool that you will utilize for applying transformations and cleansing processes to your data. This editor can be launched as part of  establishing a connection to your data, or by simply clicking <strong>Transform Data</strong> on the <strong>Home</strong> ribbon of the Power BI Desktop. When the Power Query Editor is opened,  you will notice that it has its own separate environment for you to work in. The environment encapsulates a user-friendly method for working  with all of the queries that you will define. Before you dive deep into  the capabilities of the Power Query Editor, let&rsquo;s first start by  reviewing the key areas of the Power Query Editor interface, as shown in <em>Figure 2.1</em>:</p>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/1.png" alt="img" /></p>

<p>Figure 2.1: First view of the Power Query Editor</p>

<p>Following the numbered figures, let&rsquo;s review some of the most important features of the Power Query Editor:</p>

<ol>
<li><strong>New Source</strong>: This launches the interface to establish your connection details, which is the same interface as the <strong>Get data</strong> button that you learned about in <em>Chapter 1</em>, <em>Getting Started with Importing Data Options</em>.</li>
<li>The <strong>Queries</strong> pane: A list of all the queries that you have connected to. From here, you  can rename a query, disable the load and modify report refresh  capabilities, and organize your queries into groups.</li>
<li><strong>Query Settings</strong>: Within this pane, you can rename the query, but more importantly, you  can see and change the list of steps, or transforms, that have been  applied to your query. If you ever accidentally close this pane, you can relaunch it from the <strong>View</strong> menu.</li>
<li><strong>Advanced Editor</strong>: By launching the <strong>Advanced Editor</strong>, you can see the M query that is automatically written for you by the Power Query Editor.</li>
<li><strong>Close &amp; Apply</strong>: Choosing this option will close the Power Query Editor and load the results into the data model.</li>
</ol>

<p>With this basic navigation understood, let&rsquo;s start to discuss some of the basics of working with various transforms.</p>

<h1 id="transform-basics">Transform basics</h1>

<p>Applying data transformations within the Power Query Editor can be a surprisingly simple thing to do. However, there are a few things to consider as we begin this process.  The first is that there are multiple ways to solve a problem. As you  work your way through this book, the authors have tried to show you the  fastest and easiest methods of solving the problems that are presented,  but these solutions will certainly not be the only ways to reach your  goals.</p>

<p>The next thing you should understand is that every click you do inside the Power Query Editor is automatically converted  into a formula language called M. Virtually all the basic transforms you will need can be accomplished by simply interacting with the Power  Query Editor user interface, but for more complex business problems  there is a good chance you may have to modify the M queries that are  written for you by the editor. You will learn more about M later in this chapter.</p>

<p>Finally, the last important consideration to  understand is that all transforms that are created within the editor are stored in the <strong>Query Settings</strong> pane under a section called <strong>Applied Steps</strong>. Why is this important to know? The <strong>Applied Steps</strong> section has many features, but here are some of the most critical to know for now:</p>

<ul>
<li><strong>Deleting transforms</strong>: If you make a mistake and need to undo a step, you can click the <strong>Delete</strong> button next to a step.</li>
<li><strong>Modifying transforms</strong>: This can be done with any step that has a gear icon next to it.</li>
<li><strong>Changing the order of transforms</strong>: If you realize that it is better for one step to execute before another one, you can change the order of how the steps are executed.</li>
<li><strong>Selecting previous steps</strong>: Clicking on any step prior to the current one will allow you to see how your query results would change one step earlier in the process.</li>
</ul>

<p>With this understanding, you will now get hands-on with applying several basic transforms inside the Power Query Editor.  The goal of these first sets of examples is to get you comfortable with the Power Query Editor user interface before the more complex use cases are covered.</p>

<h2 id="use-first-row-as-headers">Use First Row as Headers</h2>

<p>Organizing column names or headers is often an important first task when managing your dataset. Providing relevant column names makes many of the downstream processes, such as building  reports, much easier. Often, column headers are automatically imported  from your data source, but sometimes you may be working with a more  unique data source that makes it difficult for Power BI to capture the  column header information. This walkthrough will show how to deal with  such a scenario:</p>

<ol>
<li><p>Launch Power BI Desktop, and click <strong>Get data</strong> on the <strong>Home</strong> ribbon.</p></li>

<li><p>Choose <strong>Excel</strong>, then navigate to and select <strong>Open</strong> on the <code>Failed Bank List.xlsx</code> file that is available in the book source files.</p></li>

<li><p>In the <strong>Navigator</strong> window, select the table called <strong>Data</strong>, then choose <strong>Transform Data</strong>. When the Power Query Editor launches, you should notice that the column headers are not automatically imported. In fact, the column headers are in the first row of the data.</p></li>

<li><p>To push the column names that are in the first row of data to the header section, select the transform called</p></li>
</ol>

<p>Use First Row as Headers</p>

<pre><code>from the 
</code></pre>

<p>Home</p>

<pre><code>ribbon as shown in 
</code></pre>

<p>Figure 2.2</p>

<p>:</p>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_03.png" alt="img" /></p>

<p>Figure 2.2: Leveraging the Use First Row as Headers transform</p>

<p>Once complete, you will see the first row of the  dataset has been promoted to the column header area. This is a very  common transform that you can expect to use often with flat files. Next, let&rsquo;s look at another commonly used transform, <strong>Remove Columns</strong>.</p>

<h2 id="remove-columns">Remove Columns</h2>

<p>Often, the data sources you will connect to will include many columns that are not necessary for the solution you are designing. It is important to remove these  unnecessary columns from your dataset because these unused columns  needlessly take up space inside your data model. There are several  different methods for removing columns in the Power Query Editor. This  example will show one of these methods using the same dataset from the  previous demonstration:</p>

<ol>
<li><p>Multi-select (<em>Ctrl</em> + click) the column headers of the columns you wish to keep as part of your solution. In this scenario, select the columns <strong>Bank Name</strong>, <strong>City</strong>, <strong>ST</strong>, and <strong>Closing Date</strong>.</p></li>

<li><p>With these four columns selected, right-click on any of the selected columns and choose</p></li>
</ol>

<p>Remove Other Columns</p>

<p>, as shown in</p>

<p>Figure 2.3</p>

<p>:</p>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_04.png" alt="img" /></p>

<p>Figure 2.3: Selecting the Remove Other Columns transform</p>

<p>Once this transform is completed, you should be left with only the columns you need.</p>

<p>Another popular method for removing columns is clicking the <strong>Choose Columns</strong> button on the <strong>Home</strong> ribbon of the Power Query Editor. This option provides a list of all  the columns, and you can choose the columns you wish to keep or exclude.</p>

<p>You can also select the columns you wish to remove; right-click on one of the selected columns and click <strong>Remove</strong>. This seems like the more obvious method. However, this option is not as user-friendly in the long run because it does not provide an option to  edit the transform in the <strong>Applied Steps</strong> section like the first two methods do.</p>

<p>With any data cleansing tool, data type manipulation is critical and can help save you from many headaches later in the development of your solution. In the next section, you will learn about how to change data types.</p>

<h2 id="change-type">Change Type</h2>

<p>Defining column data types properly early on in your data scrubbing process can help to ensure proper business rules can be applied and data is presented properly in reports. The Power  Query Editor has various numeric, text, and date-time data types for you to choose from. In our current example, all of the data types were  automatically interpreted correctly by the Power Query Editor, but let&rsquo;s look at where you could change this if necessary:</p>

<ol>
<li><p>Locate the data type indicator on the column header to the left of the column name.</p></li>

<li><p>Click the data type icon, and a menu will open that allows you to choose whichever data type you desire, as shown in</p></li>
</ol>

<p>Figure 2.4</p>

<p>:</p>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_05.png" alt="img" /></p>

<p>Figure 2.4: Choosing a different data type</p>

<p>Another method you can use for changing column data types is to right-click on the column you wish to change, then select <strong>Change Type</strong> and choose the new data type. You should always be careful when  changing data types to ensure your data supports the change. For instance, if you change a column data type to a Whole Number while it has letters stored in it, Power BI will produce an error.</p>

<p>If you want to change multiple  column data types at once, you can multi-select the necessary columns,  then select the new data type from the <strong>Data Type</strong> property on the <strong>Home</strong> ribbon.</p>

<p>Many of the transforms you will encounter in the  future are contextually based on the column data types you are working  with. For example, if you have a column that is a date, then you will be provided with special transforms that can only be executed against a  date data type, such as extracting the month name from a date column.</p>

<p>Understanding how to properly set data types in  Power BI is often the first step to using more exciting transforms. In  the next section, you will learn how Power BI can read from an example  you provide to automatically create transform rules.</p>

<h2 id="column-from-examples">Column From Examples</h2>

<p>One option that can make complex data transformations seem simple is the feature called <strong>Add Column From Examples</strong>. Using <strong>Add Column From Examples</strong>, you can provide the Power Query Editor with a sample of what you would  like your data to look like, and it can then automatically determine  which transforms are required to accomplish your goal. Continuing with  the same failed banks example, let&rsquo;s walk through a simple example of  how to use this feature:</p>

<ol>
<li><p>Find and select the <strong>Add Column</strong> tab in the Power Query Editor ribbon.</p></li>

<li><p>Select the</p></li>
</ol>

<p>Column From Examples</p>

<pre><code>button and, if prompted, choose 
</code></pre>

<p>From All Columns</p>

<p>. This will launch a new</p>

<p>Add Column From Examples</p>

<pre><code>interface:
</code></pre>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_06.png" alt="img" /></p>

<p>Figure 2.5: Choosing the Column from Examples transform</p>

<ol>
<li><p>Our goal is to leverage this feature to combine the <code>City</code> and <code>ST</code> columns together. In the first empty cell, type <code>Barboursville, WV</code> and then hit <em>Enter</em>. In <em>Figure 2.5</em> you will notice that the text you typed has automatically been  translated into an M query and applied for every row in the dataset.</p></li>

<li><p>Once you click</p></li>
</ol>

<p>OK</p>

<p>, the transform is finalized and automatically added to the overall M  query that has been built through the user interface. The newly merged  column will be added with the rest of your columns and you can  optionally rename the column something more appropriate by  double-clicking on the column header:</p>

<pre><code>![img](https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_07.png)
</code></pre>

<p>Figure 2.6: Adding Column from Examples</p>

<p>As you can see, the <strong>Add Column from Examples</strong> feature is great because you don&rsquo;t have to be an expert in which  transforms are appropriate because Power BI will automatically choose  them for you!</p>

<p>Sometimes, you may encounter scenarios where the <strong>Add Column From Examples</strong> feature needs more than one example to properly translate your example  into an M query function that accomplishes your goal. If this happens,  simply provide additional examples of how you would like the data to  appear in different rows, and the Power Query Editor should adjust to  account for outliers.</p>

<p>Now that you have learned some basic transforms, let&rsquo;s explore some more complex design patterns that are still used quite frequently.</p>

<h1 id="advanced-data-transformation-options">Advanced data transformation options</h1>

<p>Now that you should be more comfortable working within the Power Query Editor, let&rsquo;s take the next step and discuss more advanced options. Often, you will find the need to go beyond these basic transforms when dealing with data that requires more care. In  this section, you will learn about some common advanced transforms that  you may have a need for, which include <strong>Conditional Columns</strong>, <strong>Fill Down</strong>, <strong>Unpivot</strong>, <strong>Merge Queries</strong>, and <strong>Append Queries</strong>.</p>

<h2 id="conditional-columns">Conditional Columns</h2>

<p>Using the Power Query Editor <strong>Conditional Columns</strong> functionality is a great way to add new columns to your query that follow logical <code>if</code>/<code>then</code>/<code>else</code> statements. This concept of <code>if</code>/<code>then</code>/<code>else</code> is common across many programming languages, including Excel formulas.  Let&rsquo;s review a real-world scenario where you would be required to do  some data cleansing on a file before it could be used. In this example,  you will be provided with a file of all the counties in the United  States, and you must create a new column that extracts the state name  from the county column and places it in its own column:</p>

<ol>
<li><p>Start by connecting to the <code>FIPS_CountyName.txt</code> file that is found in the book files using the <strong>Text</strong>/<strong>CSV</strong> connector.</p></li>

<li><p>Launch the Power Query Editor by selecting <strong>Transform Data</strong>, then start by changing the data type of <code>Column1</code> to <strong>Text</strong>. When you do this, you will be prompted to replace an existing type conversion. You can accept this by clicking <strong>Replace current</strong>.</p></li>

<li><p>Now, on <code>Column2</code>, filter out the value <strong>UNITED STATES</strong> from the column by clicking the arrow next to the column header and unchecking <strong>UNITED STATES</strong>. Then, click <strong>OK</strong>.</p></li>

<li><p>Remove the state abbreviation from</p>

<pre><code>Column2
</code></pre>

<p>by right-clicking on the column header and selecting</p></li>
</ol>

<p>Split Column</p>

<pre><code>| 
</code></pre>

<p>By Delimiter</p>

<p>. Choose</p>

<p>&ndash; Custom &ndash;</p>

<pre><code>for the delimiter type, and type 
</code></pre>

<p>,</p>

<pre><code>before then clicking 
</code></pre>

<p>OK</p>

<p>, as shown in</p>

<p>Figure 2.7</p>

<p>:</p>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_08.png" alt="img" /></p>

<p>Figure 2.7: Splitting a column based on a delimiter</p>

<ol>
<li><p>Next, rename the column names <code>Column1</code>, <code>Column 2.1</code>, and <code>Column 2.2</code>, to <code>County Code</code>, <code>County Name</code>, and <code>State Abbreviation</code>, respectively.</p></li>

<li><p>To isolate the full state name into its own column, you will need to implement <strong>Conditional Column</strong>. Go to the <strong>Add Column</strong> ribbon and select <strong>Conditional Column</strong>.</p></li>

<li><p>Change the</p></li>
</ol>

<p>New column name</p>

<pre><code>property to 
</code></pre>

<pre><code>   State Name
</code></pre>

<pre><code>and implement the logic 
</code></pre>

<pre><code>   If State Abbreviation equals null Then return County Name Else return null
</code></pre>

<pre><code>as shown in 
</code></pre>

<p>Figure 2.8</p>

<p>. To return the value from another column, you must select the icon in the</p>

<p>Output</p>

<pre><code>property, then choose 
</code></pre>

<p>Select a column</p>

<p>. Once this is complete, click</p>

<p>OK</p>

<p>:</p>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_09.png" alt="img" /></p>

<p>Figure 2.8: Adding a conditional column</p>

<p>This results in a new column called <strong>State Name</strong>, which has the fully spelled-out state name only appearing on rows where the <code>State Abbreviation</code> is <code>null</code>:</p>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_10.png" alt="img" /></p>

<p>Figure 2.9: End result of following these steps</p>

<p>This is only setting the stage to fully scrub this dataset. To complete the data cleansing process for this file, read on  to the next section about <strong>Fill Down</strong>. However, for the purposes of this example, you have now learned how to leverage the capabilities of the <strong>Conditional Column</strong> transform in the Power Query Editor.</p>

<h2 id="fill-down">Fill Down</h2>

<p><strong>Fill Down</strong> is a rather unique transform in how it operates. By selecting <strong>Fill Down</strong> on a particular column, a value will replace all <code>null</code> values below it until another non-null appears. When another non-null value is present, that value will then fill down to all subsequent <code>null</code> values. To examine this transform, you will pick up from where you left off in the <strong>Conditional Column</strong> example in the previous section:</p>

<ol>
<li><p>Right-click on the <strong>State Name</strong> column header and select <strong>Transform</strong> | <strong>Capitalize Each Word</strong>. This transform should be self-explanatory.</p></li>

<li><p>Next, select the <strong>State Name</strong> column and, in the <strong>Transform</strong> ribbon, select <strong>Fill</strong> | <strong>Down</strong>. This will take the value in the <strong>State Name</strong> column and replace all non-null values until there is another <strong>State Name</strong> value that it can switch to. After performing this transform, scroll through the results to ensure that the value of <code>Alabama</code> switches to <code>Alaska</code> when appropriate.</p></li>

<li><p>To finish this example, filter out any</p>

<pre><code>null
</code></pre>

<p>values that appear in the</p></li>
</ol>

<p>State Abbreviation</p>

<pre><code>column. The final result should look like 
</code></pre>

<p>Figure 2.10</p>

<p>, as follows:</p>

<pre><code>![img](https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_11.png)
</code></pre>

<p>Figure 2.10: End result of following these steps</p>

<p>In this example, you learned how you can use <strong>Fill Down</strong> to replace all of the <code>null</code> values below a non-null value. You can also use <strong>Fill Up</strong> to do the opposite, which would replace all the <code>null</code> values above a non-null value. One important thing to note is that the data must be sorted properly for <strong>Fill Down</strong> or <strong>Fill Up</strong> to be successful. In the next section, you will learn about another advanced transform, known as <strong>Unpivot</strong>.</p>

<h2 id="unpivot">Unpivot</h2>

<p>The <strong>Unpivot</strong> transform is an incredibly powerful transform that allows you to reorganize your dataset into a more structured format best suited for BI. Let&rsquo;s discuss this by visualizing a practical example to help understand the purpose of <strong>Unpivot</strong>. Imagine you are provided with a file that contains the populations of US states over the last three years, and looks as in <em>Figure 2.11</em>:</p>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_12.png" alt="img" /></p>

<p>Figure 2.11: Example data that will cause problems in Power BI</p>

<p>The problem with data stored like this is you  cannot very easily answer simple questions. For example, how would you  answer questions like, <em>What was the total population for all states in the US in 2018?</em> or <em>What was the average state population in 2016?</em> With the data stored in this format, simple reports are made rather difficult to design. This is where the <strong>Unpivot</strong> transform can be a lifesaver. Using <strong>Unpivot</strong>, you can change this dataset into something more acceptable for an analytics project, as shown in <em>Figure 2.12</em>:</p>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_13.png" alt="img" /></p>

<p>Figure 2.12: Results of unpivoted data</p>

<p>Data stored in this format can now easily answer  the questions posed earlier by simply dragging a few columns into your  visuals. To accomplish this in other programming languages would often require fairly complex logic, while the Power Query Editor does it in just a few clicks.</p>

<p>There are three different methods for selecting the <strong>Unpivot</strong> transform that you should be aware of, and they include the following options:</p>

<ul>
<li><strong>Unpivot Columns</strong>: Turns any selected columns, headers into row values and the data in  those columns into a corresponding row. With this selection, any new  columns that may get added to the data source <em>will</em> automatically be included in the <strong>Unpivot</strong> transform.</li>
<li><strong>Unpivot Other Columns</strong>: Turns all column headers that <em>are not</em> selected into row values and the data in those columns into a  corresponding row. With this selection, any new columns that may get  added to the data source <em>will</em> automatically be included in the <strong>Unpivot</strong> transform.</li>
<li><strong>Unpivot Only Selected Columns</strong>: Turns any selected columns&rsquo; headers into row values and the data in  those columns into a corresponding row. With this selection, any new  columns that may get added to the data source <em>will not</em> be included in the <strong>Unpivot</strong> transform.</li>
</ul>

<p>Let&rsquo;s walk through two examples of using the <strong>Unpivot</strong> transform to show you the first two of these methods, and provide an  understanding of how this complex problem can be solved with little  effort in Power BI. The third method mentioned for doing <strong>Unpivot</strong> will not be shown since it&rsquo;s so similar to the first option:</p>

<ol>
<li><p>Launch a new instance of the Power BI Desktop, and use the Excel connector to import the workbook called</p>

<pre><code>Income Per Person.xlsx
</code></pre>

<p>found in the book source files. Once you</p></li>
</ol>

<p>select this workbook, choose the spreadsheet called</p>

<p>Data</p>

<pre><code>in the 
</code></pre>

<p>Navigator</p>

<pre><code>window, and then select 
</code></pre>

<p>Transform Data</p>

<pre><code>to launch the Power Query Editor. 
</code></pre>

<p>Figure 2.13</p>

<pre><code>shows what our data looks like before the 
</code></pre>

<p>Unpivot</p>

<pre><code>operation:
</code></pre>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_14.png" alt="img" /></p>

<p>Figure 2.13: Example before Unpivot is performed</p>

<ol>
<li><p>Now, make the first row of data into column headers by selecting the transform called <strong>Use First Row as Headers</strong> on the <strong>Home</strong> ribbon.</p></li>

<li><p>Rename the <strong>GDP per capita PPP, with projections</strong> column to <strong>Country</strong>.</p></li>

<li><p>If you look closely at the column headers,  you can tell that most of the column names are actually years and the  values inside those columns are the income for those years. This is not  the ideal way to store this data because it would be incredibly  difficult to answer a question like, <em>What is the average income per person for Belgium?</em> To make it easier to answer this type of question, right-click on the <strong>Country</strong> column and select <strong>Unpivot Other Columns</strong>.</p></li>

<li><p>Rename the columns <code>Attribute</code> and <code>Value</code> to <code>Year</code> and <code>Income</code>, respectively.</p></li>

<li><p>To finish this first example, you should also rename this query</p></li>
</ol>

<p>Income</p>

<p>. The results of these first steps can be seen in</p>

<p>Figure 2.14</p>

<p>:</p>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_15.png" alt="img" /></p>

<p>Figure 2.14: Results of unpivoted data</p>

<p>This first method walked you through what can often be the fastest method for performing an <strong>Unpivot</strong> transform, which is by using the <strong>Unpivot Other Columns</strong> option. In this next example, you will learn how to use the <strong>Unpivot Columns</strong> method as well:</p>

<ol>
<li>Remain in the Power Query Editor, and select</li>
</ol>

<p>New Source</p>

<pre><code>from the 
</code></pre>

<p>Home</p>

<pre><code>ribbon. Use the Excel connector to import the 
</code></pre>

<pre><code>   Total Population.xlsx
</code></pre>

<pre><code>workbook from the book source files. Once you select this workbook, choose the spreadsheet called 
</code></pre>

<p>Data</p>

<pre><code>in the 
</code></pre>

<p>Navigator</p>

<pre><code>window, and then select 
</code></pre>

<p>OK</p>

<p>.</p>

<p>Figure 2.15</p>

<pre><code>shows the dataset before 
</code></pre>

<p>Unpivot</p>

<pre><code>has been added:
</code></pre>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_16.png" alt="img" /></p>

<p>Figure 2.15: Example before Unpivot is performed</p>

<ol>
<li><p>Like the last example, you will again need to make the first row of data into column headers by selecting the transform called <strong>Use First Row as Headers</strong> on the <strong>Home</strong> ribbon.</p></li>

<li><p>Then, rename the column <strong>Total population</strong> to <strong>Country</strong>.</p></li>

<li><p>This time, multi-select all the columns except</p></li>
</ol>

<p>Country</p>

<p>, then right-click on one of the selected columns and choose</p>

<p>Unpivot Other Columns</p>

<pre><code>as shown in 
</code></pre>

<p>Figure 2.16</p>

<p>. The easiest way to multi-select these columns is to select the first column then hold</p>

<p>Shift</p>

<pre><code>before clicking the last column:
</code></pre>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_17.png" alt="img" /></p>

<p>Figure 2.16: Using the Unpivot Other Columns transform</p>

<ol>
<li>Rename the columns from</li>
</ol>

<p>Attribute</p>

<pre><code>and 
</code></pre>

<p>Value</p>

<pre><code>to 
</code></pre>

<p>Year</p>

<pre><code>and 
</code></pre>

<p>Population</p>

<p>, respectively, to see the result showing in</p>

<p>Figure 2.17</p>

<p>:</p>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_18.png" alt="img" /></p>

<p>Figure 2.17: Shows the final result of these steps</p>

<p>In this section, you learned about two different methods for performing an <strong>Unpivot</strong>. To complete the data cleansing process on these two datasets, it&rsquo;s  recommended that you continue through the next section on merging  queries.</p>

<h2 id="merge-query">Merge Query</h2>

<p>Another common requirement when building BI solutions is the need to join two tables together to form a new outcome that includes some columns from both tables in the result.  Fortunately, Power BI makes this task very simple with the <strong>Merge Queries</strong> feature. Using this feature requires that you select two tables and  then determine which column or columns will be the basis of how the two  queries are merged. After determining the appropriate columns for your  join, you will select a join type. The join types are listed here with  the description that is provided within the product:</p>

<ul>
<li><strong>Left Outer</strong> (all rows from the first table, only matching rows from the second)</li>
<li><strong>Right Outer</strong> (all rows from the second table, only matching rows from the first)</li>
<li><strong>Full Outer</strong> (all rows from both tables)</li>
<li><strong>Inner</strong> (only matching rows from both tables)</li>
<li><strong>Left Anti</strong> (rows only in the first table)</li>
<li><strong>Right Anti</strong> (rows only in the second table)</li>
</ul>

<p>Many of you may already be very familiar with these different join terms from SQL programming you have  learned in the past. However, if these terms are new to you, I recommend reviewing <em>Visualizing Merge Join Types in Power BI</em>, courtesy of Jason Thomas in the <em>Power BI Data Story Gallery</em>: <a href="https://community.powerbi.com/t5/Data-Stories-Gallery/Visualizing-Merge-Join-Types-in-Power-BI/m-p/219906" target="_blank">https://community.powerbi.com/t5/Data-Stories-Gallery/Visualizing-Merge-Join-Types-in-Power-BI/m-p/219906</a>. This visual aid is a favorite of many users that are new to these concepts.</p>

<p>To examine the <strong>Merge Queries</strong> option, you will pick up from where you left off with the <strong>Unpivot</strong> examples in the previous section:</p>

<ol>
<li><p>With the <strong>Population</strong> query selected, find and select <strong>Merge Queries</strong> | <strong>Merge Queries as New</strong> on the <strong>Home</strong> ribbon.</p></li>

<li><p>In the <strong>Merge</strong> dialog box, select the <strong>Income</strong> query from the drop-down selection in the middle of the screen.</p></li>

<li><p>Then, multi-select the <strong>Country</strong> and <strong>Year</strong> columns on the <strong>Population</strong> query, and do the same under the <strong>Income</strong> query. This defines which columns will be used to join the two queries  together. Ensure that the number indicators next to the column headers  match, as demonstrated in <em>Figure 2.18</em>. If they don&rsquo;t, you could accidentally attempt to join on the incorrect columns.</p></li>

<li><p>Next, select</p></li>
</ol>

<p>Inner</p>

<pre><code>(
</code></pre>

<p>only matching rows</p>

<p>) for</p>

<p>Join Kind</p>

<p>. This join type will return rows only when the columns you chose to join on have values that exist in both queries. Before you click</p>

<p>OK</p>

<p>, confirm that your screen matches</p>

<p>Figure 2.18</p>

<p>:</p>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_19.png" alt="img" /></p>

<p>Figure 2.18: Configuring a merge between two queries</p>

<ol>
<li><p>Once you select <strong>OK</strong>, this will create a new query called <code>Merge1</code> that combines the results of the two queries. Go ahead and rename this query <code>Country Stats</code>.</p></li>

<li><p>You will also notice that there is a column called <code>Income</code> that has a value of <code>Table</code> for each row. This column is actually representative of the entire <code>Income</code> query that you joined to. To choose which columns you want from this query, click the <strong>Expand</strong> button on the column header. After clicking the <strong>Expand</strong> button, uncheck <strong>Country</strong>, <strong>Year</strong>, and <strong>Use original column name as prefix</strong>, then click <strong>OK</strong>.</p></li>

<li><p>Rename the column called</p>

<pre><code>Income.1
</code></pre>

<p>to</p>

<pre><code>Income
</code></pre></li>
</ol>

<p>.</p>

<p>Figure 2.19</p>

<pre><code>shows this step completed:
</code></pre>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_20.png" alt="img" /></p>

<p>Figure 2.19: Configuring a merge between two queries</p>

<ol>
<li>Finally, since you chose the option</li>
</ol>

<p>Merge Queries as New</p>

<pre><code>in 
</code></pre>

<p>Step 1</p>

<p>, you can disable the load</p>

<p>option for the original queries that you started with. To do this, right-click on the</p>

<p>Income</p>

<pre><code>query in the 
</code></pre>

<p>Queries</p>

<pre><code>pane and click 
</code></pre>

<p>Enable load</p>

<pre><code>to disable it. Do the same thing for the 
</code></pre>

<p>Population</p>

<pre><code>query as shown in 
</code></pre>

<p>Figure 2.20</p>

<p>. Disabling these queries means that the only query that will be loaded into your Power BI data model is the new one, called</p>

<p>Country Stats</p>

<p>:</p>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_21.png" alt="img" /></p>

<p>Figure 2.20: Uncheck to disable the loading of this query into the data model</p>

<p>To begin using this dataset in a report, you would click <strong>Close &amp; Apply</strong>. You will learn more about building reports in <em>Chapter 5</em>, <em>Visualizing Data</em>.</p>

<p>By default, merging queries together relies on  exact matching values between your join column(s). However, you may work with data that does not always provide perfect matching values. For  example, a user enters data and misspells their country as &ldquo;Unite  States&rdquo; instead of <code>United States</code>. In those cases, you may consider the more advanced feature called Fuzzy Matching. With Fuzzy Matching, Power BI can perform an approximate match and  still join on these two values based on the similarity of the values. In this section, you learned how the <strong>Merge Queries</strong> option is ideal for joining two queries together. In the next section,  you will learn how you could solve the problem of performing a union of  two or more queries.</p>

<h2 id="append-query">Append Query</h2>

<p>Occasionally, you will work with multiple datasets that need to be appended to each other. Here&rsquo;s a scenario: you work for a customer service department for a company that provides  credit or loans to customers. You are regularly provided with <code>.csv</code> and <code>.xlsx</code> files that give summaries of customer complaints regarding credit cards and student loans. You would like to analyze both of these data  extracts at the same time but, unfortunately, the credit card and  student loan complaints are provided in two separate files. In this  example, you will learn how to solve this problem by performing an  append operation on these two different files:</p>

<ol>
<li><p>Launch a new instance of the Power BI Desktop, and use the Excel connector to import the workbook called <code>Student Loan Complaints.xlsx</code> found in the book source files. Once you select this workbook, choose the spreadsheet called <strong>Student Loan Complaints</strong> in the <strong>Navigator</strong> window, and then select <strong>Transform Data</strong> to launch the Power Query Editor.</p></li>

<li><p>Next, import the credit card data by selecting <strong>New Source</strong> | <strong>Text/CSV</strong>, then choose the file called <code>Credit Card Complaints.csv</code> found in the book source files. Click <strong>OK</strong> to bring this data into the Power Query Editor.</p></li>

<li><p>With the <code>Credit Card Complaints</code> query selected, find and select <strong>Append Queries</strong> | <strong>Append Queries as New</strong> on the <strong>Home</strong> ribbon.</p></li>

<li><p>Select</p></li>
</ol>

<p>Student Loan Complaints</p>

<pre><code>as the table to append to, then select 
</code></pre>

<p>OK</p>

<pre><code>as shown in 
</code></pre>

<p>Figure 2.21</p>

<p>:</p>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_22.png" alt="img" /></p>

<p>Figure 2.21: Configuring an append between two queries</p>

<ol>
<li>Rename the newly created query</li>
</ol>

<p>All Complaints</p>

<pre><code>and view the results as seen in 
</code></pre>

<p>Figure 2.22</p>

<p>:</p>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_23.png" alt="img" /></p>

<p>Figure 2.22: Configuring an append between two queries</p>

<ol>
<li><p>Similar to the  previous example, you would likely want to disable the load option for  the original queries that you started with. To do this, right-click on  the <strong>Student Load Complaints</strong> query in the <strong>Queries</strong> pane and click <strong>Enable load</strong> to disable it.</p></li>

<li><p>Do the same to the <strong>Credit Card Complaints</strong> query, and then select <strong>Close &amp; Apply</strong>.</p></li>
</ol>

<p>Now that you have learned about the various  methods for combining data, the next section will discuss a more  advanced method of working with data using the R programming language.</p>

<h1 id="leveraging-r">Leveraging R</h1>

<p>R is a very powerful scripting language that is primarily used for advanced analytics tools, but also has several integration points within Power BI. One such  integration is the ability to apply business rules to your data with the R language. Why is that important? Well, with this capability you can  extend beyond the limits of the Power Query Editor and call functions  and libraries from R to do things that would not normally be possible.  In the next two sections, you will explore how to set up your machine to leverage R within Power BI and then walk through an example of using an R script transform.</p>

<p>There are many additional books and references you can read to learn more about the R scripting  language, but for the purposes of this book, our goal is to inform you  of what is possible when R and Power BI are combined.</p>

<h2 id="installation-and-configuration">Installation and configuration</h2>

<p>To use R within Power BI, you must first install an R distribution for you to run and execute scripts against. In this book, we will leverage Microsoft&rsquo;s distribution, Microsoft R Open. It is an open source project and free for anyone to use. Once Microsoft R Open has  been installed, you can then configure Power BI to recognize the home  directory where R libraries may be installed. Let&rsquo;s walk through these  setup steps together:</p>

<ol>
<li><p>Navigate to the website <a href="https://mran.microsoft.com/download/" target="_blank">https://mran.microsoft.com/download/</a> to download and install Microsoft R Open.</p></li>

<li><p>For the purposes of our example, you will select <strong>Download</strong> next to <strong>Windows</strong>.</p></li>

<li><p>Once the download has completed, run the installation and accept all default settings and user agreements.</p></li>

<li><p>Next, launch a new instance of Power BI Desktop to set up the R integration with Power BI. Click the menu options <strong>File</strong> | <strong>Options and settings</strong> | <strong>Options</strong>.</p></li>

<li><p>Choose the</p></li>
</ol>

<p>R scripting</p>

<pre><code>section and ensure that the 
</code></pre>

<p>Detected R home directories</p>

<pre><code>property is filled with the R instance you just installed, as shown in 
</code></pre>

<p>Figure 2.23</p>

<p>:</p>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_24.png" alt="img" /></p>

<p>Figure 2.23: Mapping the R home directories in Power BI</p>

<ol>
<li>Once this is completed, click <strong>OK</strong>.</li>
</ol>

<p>With this setup now complete, let&rsquo;s see how we can take advantage of R within Power BI.</p>

<h2 id="the-r-script-transform">The R script transform</h2>

<p>With the R distribution now installed and configured to integrate with Power BI, you are now ready to see what&rsquo;s possible with these new capabilities. In this example, you will be  looking at data from the European stock market. The problem with this  dataset, which calls for it to be corrected with R, is that the file  provided to you has missing values for certain days. So, to get a more  accurate reading of the stock market, you will use an R package called <code>MICE</code> to impute the missing values:</p>

<ol>
<li><p>Before beginning in Power BI, you should ensure that the</p>

<pre><code>MICE
</code></pre>

<p>library is installed and available in the R distribution you set up in  the last section. To do this, launch Microsoft R Open from your device.  This is the basic RGui that was installed for you to run R scripts with.</p></li>
</ol>

<p>For many developers, the preferred method for writing <code>R</code> scripts is a free open source tool called RStudio. RStudio includes a code editor, debugging, and visualization tools that many find easier to work with. You can download RStudio from <a href="https://www.rstudio.com/" target="_blank">https://www.rstudio.com/</a>.</p>

<ol>
<li>Type the following script in the</li>
</ol>

<p>R Console</p>

<pre><code>window, and then hit 
</code></pre>

<p>Enter</p>

<p>:</p>

<pre><code>       install.packages(&quot;mice&quot;)
</code></pre>

<p>This input is illustrated in the following screenshot:</p>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_25.png" alt="img" /></p>

<p>Figure 2.24: Running the library install in RGui</p>

<ol>
<li>You can close the</li>
</ol>

<p>R Console</p>

<pre><code>window and return to Power BI Desktop after it returns an output like the following:        
</code></pre>

<pre><code>   package 'mice' successfully unpacked and MD5 sums checked.
</code></pre>

<ol>
<li><p>In Power BI Desktop, start by connecting to the required data source called <code>EuStockMarkets_NA.csv</code> from the book source files. Once you connect to the file, click <strong>Transform Data</strong> to launch the Power Query Editor.</p></li>

<li><p>You will notice that there are a few days missing values in the <strong>SMI</strong> (<strong>Stock Market Index</strong>) column. We would like to replace values that show <strong>NA</strong> with approximate values using an R script. Go to the <strong>Transform</strong> ribbon, and select the <strong>Run R Script</strong> button on the far right.</p></li>

<li><p>Use the following R script to call the</p>

<pre><code>MICE
</code></pre>

<p>library that you recently installed to detect what the missing values in this dataset should be:</p>

<pre><code>   # 'dataset' holds the input data for this script
   library(mice)
   tempData &lt;- mice(dataset,m=1,maxit=50,meth='pmm',seed=100)
   completedData &lt;- complete(tempData,1)
   output &lt;- dataset
   output$completedValues &lt;- completedData$&quot;SMI missing values&quot;
</code></pre></li>

<li><p>Click <strong>OK</strong>. If you are prompted with a warning indicating <strong>Information is required about data privacy</strong> click <strong>Continue</strong>.</p></li>

<li><p>Next, click on the hyperlink on the table value next to the <code>completedData</code> row to see the result of the newly implemented transform for detecting missing values.</p></li>
</ol>

<p>This new output has replaced the missing values  with new values that were detected based on the algorithm used within  the R script. To now build a set of report visuals on this example, you  can click <strong>Close &amp; Apply</strong> on the <strong>Home</strong> ribbon.</p>

<p>This is just one simple way that R can be used  with Power BI. You should note that in addition to using R as a  transform, it can also be used as a data source and as a visual within  Power BI.</p>

<p>While this book highlights the programming  language R to extend the capabilities of Power BI, some might prefer  Python. Python is another programming language that allows for  extensibility into Power BI to create new  data connectors, transforms, and visuals. So, should you choose R or  Python? That depends on which you are more comfortable with. If you have already spent time learning <code>Python</code>, then stick with that! In the next section of this chapter, you will  learn about Power BI&rsquo;s AI integration features, which give you the  ability to call on components of Azure Cognitive Services with the Power Query Editor.</p>

<h1 id="ai-insights">AI Insights</h1>

<p>As you learned in the previous section, Power BI integrates and takes advantage of outside tools to enhance the capabilities within itself. That continues to be the case with the  AI Insights features. Leveraging the AI Insights capabilities gives you  the ability to tap into core features and algorithms within Azure  Cognitive Services and expose them within Power BI. So how can this be  useful to you?</p>

<p>Imagine you work for a company that runs a  vacation rentals website. Customers can book travel and post reviews of  their trips on your website. With thousands of customers and hundreds of rental homes, it can be difficult to manage all the reviews that come  in to make sure your locations are all meeting the standards your  customers expect. With AI Insights you can run algorithms that can  perform sentiment analysis, key phrase extraction, language detection,  and even image tagging. So, if you have international customers that  post reviews, you can use language detection to understand what language the post was written in. Then you can use sentiment analysis to capture whether the review was positive or negative. Finally, using phrase  extraction, you can pull out key terms in the reviews to see if the same locations continue to receive feedback regarding similar problems.  Furthermore, if your feedback system allows photos to be posted in the  reviews, the image tagging capabilities can return a list of  characteristics found in the images posted. This would allow for  automated categorization of images using AI.</p>

<p>As you can see, these are very powerful features  that take your analytics processing to the next level. There are  limitations, however, that you should be aware of before exploring these features. As of the time that this book was published, Cognitive  Services integration is only supported for Power BI Premium capacity  nodes <code>EM2</code>, <code>A2</code>, or <code>P1</code> and above. This means if your company is not currently leveraging Power BI Premium, then these features are not available to you.</p>

<p>Before using the AI Insights  features in Power BI, you will need to change the capacity settings in  the Power BI admin portal to enable the AI workload. After turning on  the AI workload setting, you can also set the maximum amount of memory  you would like to give the workload. The general recommendation is a  memory limit of 20%.</p>

<p>In the next section, you will learn how to leverage an AI Insights Text Analytics feature called Sentiment Analysis.</p>

<h2 id="sentiment-analysis-with-text-analytics">Sentiment Analysis with Text Analytics</h2>

<p>The Text Analytics features within the AI Insights features can be incredible time-savers. Imagine  having to read paragraphs of information and conclude what was important or whether it was written in a positive or negative light. These are  exactly the type of things that this feature can do for you. In this  next example, you are going to test out one of these features by running a sentiment analysis algorithm on hotel reviews to see how customers  feel about staying at your hotel locations:</p>

<ol>
<li><p>Launch a new instance of Power BI Desktop, and use the Excel connector to import the workbook called <code>Hotel Ratings.xlsx</code> found in the book source files. Once you select this workbook, choose the spreadsheet called <strong>Reviews</strong> in the <strong>Navigator</strong> window, and then select <strong>Transform Data</strong> to launch the Power Query Editor.</p></li>

<li><p>Select <strong>Text Analytics</strong> on the <strong>Home</strong> ribbon of the Power Query Editor. If this is your first time using this feature, you may be prompted to sign into a Power BI account that has  Power BI Premium capacity assigned to it.</p></li>

<li><p>Next, you will be prompted to choose which Text Analytics algorithm you would like to use. Select</p></li>
</ol>

<p>Score sentiment</p>

<p>, as shown in</p>

<p>Figure 2.25</p>

<p>, and ensure the</p>

<p>ReviewText</p>

<pre><code>field is the 
</code></pre>

<p>Text</p>

<pre><code>that will be analyzed. Then click 
</code></pre>

<p>OK</p>

<p>:</p>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_26.png" alt="img" /></p>

<p>Figure 2.25: Using the Text Analytics feature</p>

<ol>
<li>If prompted with a data privacy warning, click <strong>Continue</strong> and then select <strong>Ignore Privacy Levels check</strong> for this file before clicking <strong>Save</strong>. This type of warning can occur when you combine two disparate sources  or services together and is to ensure it is OK for these data sources to be combined.</li>
</ol>

<p>This transform will produce a new numeric column with a value between <code>0</code> and <code>1</code> for every row in the dataset. A sentiment score of <code>.50</code> is considered neutral, while any score lower is negative and any score higher is generally positive:</p>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_27.png" alt="img" /></p>

<p>Figure 2.26: Results of Score sentiment</p>

<p>Looking at <em>Figure 2.26</em>, it looks like the AI integration, with a few exceptions, did a good job determining how to rate each review.</p>

<p>Next, in the final section of this chapter, you will be introduced to the M formula language.</p>

<h1 id="the-m-formula-language">The M formula language</h1>

<p>The Power Query Editor is the user interface that is used to design and build data imports. However,  you should also know that every transform you apply within this editor  is actually, quietly and behind the scenes, writing an M query for you.  The letter M here is a reference to the language&rsquo;s data mashup  capabilities.</p>

<p>For simple solutions, it is unlikely that you will ever need to even look at the M query that is being written, but there  are some more complex cases where it&rsquo;s helpful to understand how to read and write your own M. For the purposes of this book, covering just the  Power BI essentials, you will learn how to find the M query editor  within your solution and then understand how to read what it is doing  for you.</p>

<p>For the purposes of this example, you can open up  any previously built example, however, the screenshot used here is from  the very first example in this chapter on basic transforms:</p>

<ol>
<li><p>Using any Power BI solution you have designed, launch the Power Query Editor.</p></li>

<li><p>On the</p></li>
</ol>

<p>Home</p>

<pre><code>ribbon, select 
</code></pre>

<p>Advanced Editor</p>

<pre><code>to see the M query that has been written by the user interface. 
</code></pre>

<p>Figure 2.27</p>

<pre><code>shows an example of what your 
</code></pre>

<p>Advanced Editor</p>

<pre><code>might show:
</code></pre>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_28.png" alt="img" /></p>

<p>Figure 2.27: Understanding the elements of M</p>

<p>This query has been formatted to make it easier to read. Let&rsquo;s review the key elements that are present here:</p>

<ol>
<li><strong>The let expression</strong>: Encapsulates a set of values or named expressions to be computed.</li>
<li><strong>Named expressions or variables</strong>: The name given to a set of operations in a step. These names can be  anything, but you should note that if you wish to have a space in the  name of a step then it must be surrounded by <code>#&quot;&quot;</code>. For example, if I wanted something to be called <em>Step 1</em>, then I would have to name an expression <code>#&quot;Step 1&quot;</code>. If a space is not required in the name of your step then the double quotes are not required.</li>
<li><strong>M functions</strong>: The operations that are used to manipulate the data source.</li>
<li><strong>Prior step reference</strong>: The M query language generally executes its functions as serial  operations, meaning each operation is executed one after the other  sequentially. You can see this when you look at a query because each  call to an M function always references the prior-named expression, to  pick up where it left off.</li>
<li><strong>The in expression</strong>: Oddly, the <code>in</code> expression is actually a reference to what the query will output. Whichever named expression is referenced in the <code>in</code> expression will be what is returned back in the <code>Power Query Editor</code> preview.</li>
</ol>

<p>It is important to realize that M is case-sensitive. That means if you ever make a change to a query or write one from scratch, you should be careful because there is a  difference between &ldquo;a&rdquo; and &ldquo;A.&rdquo;</p>

<h2 id="shared">#shared</h2>

<p>As mentioned  previously, this book will not dive deep into writing your own M queries since that would be far beyond the essentials of Power BI. However, there is a great method for exploring the M functions that are available, and how to use them. Within the Power Query Editor, you can  use the <code>#shared</code> function to  return documentation on every available function in the M library. Let&rsquo;s walk through how you can leverage this tool:</p>

<ol>
<li><p>In a new instance of Power BI Desktop, select <strong>Get data</strong> and then choose <strong>Blank Query</strong>. This will launch the Power Query Editor with an empty formula bar waiting for you to provide your own M.</p></li>

<li><p>In this formula bar, type <code>= #shared</code>, then hit <em>Enter</em>. Remember that M is case-sensitive so you must use a lowercase <code>s</code> when typing <code>shared</code>.</p></li>

<li><p>This will return a list of all the available M functions. By selecting the cell that has the hyperlink text of a  certain function, you can see documentation on how to use each function.</p></li>
</ol>

<p>Figure 2.28</p>

<pre><code>shows an example of this:
</code></pre>

<p><img src="https://learning.oreilly.com/library/view/microsoft-power-bi/9781800561571/Images/B16601_02_29.png" alt="img" /></p>

<p>Figure 2.28: Example of function documentation</p>

<p>This is a great method for learning what M functions are available, and how each may be used.  If you are stumped on how to solve a problem using M then make this your first stop to explore what options you have.</p>

<h1 id="summary">Summary</h1>

<p>In this chapter, you learned that the Power Query  Editor is an extremely powerful tool for applying business rules to  incoming data. Implementing data cleansing techniques can be as simple  as right-clicking on a column, or more complex, such as when building a  conditional column. While the Power Query Editor does have a vast  library of transforms available, you also learned that you can tap into  the capabilities of R to extend what&rsquo;s possible when designing queries.  Finally, this chapter discussed the AI capabilities within the Power  Query Editor that allow you to leverage several algorithms available  within Azure Cognitive Services. In the next chapter, on building the  data model, you will learn about proper techniques for building a  well-designed Power BI data model to ensure your solutions can solve all your reporting needs.</p>

          </div>

          



          
          <div class="article-widget">
            
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="/en/power-bi/02-import-data/" rel="prev">Import data in Power BI</a>
  </div>
  
</div>

          </div>
          
        </div>

        <div class="body-footer">
          <p>Last updated on Jan 5, 2021</p>

          
<p class="edit-page">
  <a href="https://github.com/gcushen/hugo-academic/edit/master/content/resources/tutorials/power-bi/03-data-transformation-strategies.md">
    <i class="fas fa-pen pr-2"></i>Edit this page
  </a>
</p>



          

        </div>

      </article>

      <footer class="site-footer">
  

  <p class="powered-by">
    &copy; 2021 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
  </p>
</footer>


    </main>
  </div>
</div>


      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.0.0/mermaid.min.js" integrity="sha256-0w92bcB21IY5+rGI84MGj52jNfHNbXVeQLrZ0CGdjNY=" crossorigin="anonymous" title="mermaid"></script>
      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/r.min.js"></script>
        
      

      
      
    

    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/en/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    <script id="dsq-count-scr" src="https://marcusrb.disqus.com/count.js" async></script>
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.4e51017b38c7ebaadd7e25fc9503f88c.js"></script>

    






  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
